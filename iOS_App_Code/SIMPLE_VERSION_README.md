# 📱 SRT字幕翻译工具 - 简化版

## 🎯 功能说明

这是一个简化版的iOS应用，专注于核心功能：

1. ✅ **上传SRT字幕文件** - 选择英文字幕文件
2. ✅ **AI翻译** - 使用Deepseek API翻译成中文
3. ✅ **查看双语字幕** - 在应用内查看翻译结果
4. ✅ **下载双语字幕** - 导出双语SRT文件

## 📋 使用步骤

### 1. 替换代码

将 `ContentView_v2.swift` 的内容复制到您的Xcode项目中的 `ContentView.swift`

### 2. 配置API密钥

在代码中找到这一行（第530行左右）：

```swift
private let apiKey = "sk-8fc6d65b137148bbb0470a815f969937"
```

确保这是您的有效Deepseek API密钥。

### 3. 运行应用

1. 连接iPhone到Mac
2. 在Xcode中选择您的iPhone
3. 点击运行按钮（▶️）

## 🎨 应用界面

```
┌─────────────────────────────┐
│  SRT字幕翻译工具             │
├─────────────────────────────┤
│                             │
│  📄                          │
│  点击选择SRT字幕文件         │
│  (或显示已选择的文件名)      │
│                             │
│  [开始翻译]                  │
│                             │
│  进度: ████████░░ 80%       │
│                             │
│  ✓ 翻译完成！共68条字幕      │
│                             │
│  [查看双语字幕]              │
│  [下载双语字幕]              │
│                             │
└─────────────────────────────┘
```

## 📝 使用流程

### 步骤1：准备SRT文件

从您的电脑或其他来源获取英文SRT字幕文件。

**示例SRT格式：**
```
1
00:00:00,000 --> 00:00:05,000
Hello world

2
00:00:05,000 --> 00:00:10,000
This is a test
```

### 步骤2：上传文件

1. 打开应用
2. 点击"点击选择SRT字幕文件"
3. 从文件选择器中选择您的SRT文件
4. 应用会显示文件名和字幕数量

### 步骤3：翻译

1. 点击"开始翻译"按钮
2. 等待翻译完成（会显示进度）
3. 翻译完成后会显示"翻译完成"

### 步骤4：查看和下载

**查看字幕：**
- 点击"查看双语字幕"
- 滚动查看所有翻译结果
- 英文在上，中文在下

**下载字幕：**
- 点击"下载双语字幕"
- 选择保存位置（文件、邮件、AirDrop等）
- 文件名会自动添加"_bilingual"后缀

## 🔧 技术特点

### 核心功能

1. **SRT解析器**
   - 自动解析SRT文件格式
   - 提取时间轴和文本内容
   - 支持多行字幕

2. **AI翻译**
   - 使用Deepseek API
   - 逐条翻译，保持准确性
   - 自动限速，避免API限制

3. **双语字幕生成**
   - 英文+中文双行显示
   - 保持原有时间轴
   - 标准SRT格式输出

4. **文件分享**
   - 使用iOS系统分享功能
   - 支持保存到文件、AirDrop、邮件等
   - 自动生成文件名

### 代码结构

```
ContentView.swift
├── UI组件
│   ├── headerView - 标题
│   ├── filePickerView - 文件选择
│   ├── translateButtonView - 翻译按钮
│   ├── progressView - 进度显示
│   ├── statusView - 状态信息
│   └── actionButtonsView - 操作按钮
├── 核心功能
│   ├── handleFileSelection - 处理文件选择
│   ├── translateSubtitles - 翻译字幕
│   ├── parseSRT - 解析SRT文件
│   ├── buildBilingualSRT - 生成双语字幕
│   └── saveBilingualSRT - 保存文件
└── 辅助组件
    ├── SubtitleListView - 字幕列表视图
    ├── ShareSheet - 分享面板
    └── DeepseekAPI - API服务
```

## 📊 输出格式

**双语SRT文件格式：**
```
1
00:00:00,000 --> 00:00:05,000
Hello world
你好世界

2
00:00:05,000 --> 00:00:10,000
This is a test
这是一个测试
```

## ⚙️ 配置选项

### API设置

在 `DeepseekAPI` 类中可以调整：

```swift
// API密钥
private let apiKey = "your-api-key"

// 翻译提示词
"你是一个专业的翻译助手，请将英文准确翻译成中文，保持简洁明了。"

// 温度参数（0-1，越低越准确）
"temperature": 0.3

// 最大token数
"max_tokens": 1000
```

### 限速设置

在 `translateSubtitles` 函数中：

```swift
// 每10条字幕暂停1秒
if (index + 1) % 10 == 0 {
    try await Task.sleep(nanoseconds: 1_000_000_000)
}
```

## 🐛 常见问题

### Q: 文件选择器打不开？
A: 确保在Info.plist中添加了文件访问权限：
```xml
<key>UISupportsDocumentBrowser</key>
<true/>
```

### Q: 翻译失败？
A: 检查：
- API密钥是否正确
- 网络连接是否正常
- API额度是否充足

### Q: 无法下载文件？
A: 确保：
- 已授予文件访问权限
- 选择了有效的保存位置
- 设备有足够存储空间

### Q: 翻译速度慢？
A: 这是正常的，因为：
- 逐条翻译保证准确性
- 自动限速避免API限制
- 可以调整限速参数加快速度

## 🎯 优化建议

### 短期优化

1. **批量翻译**
   - 将多条字幕合并翻译
   - 提高翻译速度
   - 降低API调用次数

2. **缓存机制**
   - 保存已翻译的字幕
   - 避免重复翻译
   - 支持离线查看

3. **错误重试**
   - 自动重试失败的翻译
   - 显示详细错误信息
   - 支持手动重试

### 长期优化

1. **多语言支持**
   - 支持其他语言翻译
   - 自动检测源语言
   - 自定义目标语言

2. **高级功能**
   - 字幕编辑功能
   - 时间轴调整
   - 字幕合并/分割

3. **云端同步**
   - iCloud同步
   - 历史记录
   - 多设备共享

## 📚 相关资源

### SRT格式规范
- [SRT字幕格式说明](https://en.wikipedia.org/wiki/SubRip)
- 时间格式：HH:MM:SS,mmm
- 编码：UTF-8

### Deepseek API
- [API文档](https://platform.deepseek.com/docs)
- [定价信息](https://platform.deepseek.com/pricing)
- [使用限制](https://platform.deepseek.com/limits)

## 🎉 完成！

现在您有了一个完整可用的SRT字幕翻译iOS应用！

**主要优势：**
- ✅ 简单易用
- ✅ 功能专注
- ✅ 真实可用
- ✅ 无需服务器
- ✅ 完全离线处理（除翻译API）

祝您使用愉快！🎊
